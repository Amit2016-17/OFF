<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>OFF: Parallel Performance</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">OFF
   </div>
   <div id="projectbrief">an Open source Finite volumes Fluid dynamics code</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>README</span></a></li>
      <li><a href="../../modules.html"><span>API</span></a></li>
      <li><a href="../../files.html"><span>Source&#160;Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('de/d01/Scalability.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Parallel Performance </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Partial Assessment of Parallel Scalability on small HPC Cluster</p>
<p>For the (partial) assessment of <em>OFF</em> performance let us consider the fifth test of Kurganov and Tadmor [<a class="el" href="../../d5/de2/TWOD-RP.html#kurganov">1</a>] reported in the example section <a class="el" href="../../d5/de2/TWOD-RP.html#kt-c05">Configuration 5:</a>. Four different grid refinement levels have been considered for the whole <img class="formulaInl" alt="$[0,1]\times[0,1]$" src="../../form_102.png"/> two dimensional domain ranging from <img class="formulaInl" alt="$100\times100=10000$" src="../../form_103.png"/> (grid-1) to <img class="formulaInl" alt="$800\times800=640000$" src="../../form_104.png"/> (grid-4) finite volumes. Each grid level is four times finer than the previous one.</p>
<p>Two different architectures have been used: 1) shared memory multicore workstation and 2) distributed memory cluster built up of shared memory multicore nodes. The shared memory workstation has two Esa core (12 cores) Intel(R) Xeon(R) X5650 at 2.67GHz with 24GB of DDR3 RAM at 1333MHz, whereas the cluster nodes have two Quad core (8 cores) Intel(R) Xeon(R) X5462 at 2.8GHz with 8GB of DDR3 RAM at 800MHz.</p>
<p>The numerical grid of the example section has been modified: each original block has been split into 4 new ones obtaining a 16 blocks grid. This allows to use up to 16 MPI processes increasing the tests matrix.</p>
<p>The assessment of <em>OFF</em> scalability has been performed comparing the performance of the serial-compiled code with respect the parallel versions ones. In particular, defined <img class="formulaInl" alt="$CPU_{SER}$" src="../../form_105.png"/> the CPU time used for the serial runs, the speedup is defined as <img class="formulaInl" alt="$\frac{CPU}{CPU_{SER}}$" src="../../form_106.png"/>. As a consequence, the ideal speedup is a linear function of the number of cores (processors, indicated as <img class="formulaInl" alt="$\#CORE$" src="../../form_107.png"/> hereafter) used, ranging from <img class="formulaInl" alt="$1$" src="../../form_108.png"/> (serial case) to <img class="formulaInl" alt="$\frac{1}{\#CORE}$" src="../../form_109.png"/> (best case). In both the two architectures, three different parallel compilations have been considered: 1) pure OpenMP, 2) pure MPI and 3) hybrid OpenMP/MPI. All serial and parallel compilations have been performed using Intel Fortran compiler v. 13.1.1 and OpenMPI v. 1.6.4 (compiled with Intel Parallel suite, v. 13.1.1). Moreover, the -O3 (entailing vectorization) and -ipo optimization flags have been used.</p>
<h1><a class="anchor" id="SharedMemSpeedUP"></a>
SpeedUp on Shared Memory Architecture</h1>
<p>Figures <a class="el" href="../../de/d01/Scalability.html#fig-shaspeedup050">1</a>, <a class="el" href="../../de/d01/Scalability.html#fig-shaspeedup100">2</a>, <a class="el" href="../../de/d01/Scalability.html#fig-shaspeedup200">3</a> and <a class="el" href="../../de/d01/Scalability.html#fig-shaspeedup400">4</a> summarize the tests matrix performed on the shared memory architecture and the computed speedup. For the pure OpenMP runs all 11 possible configurations have been tested with the number of OpenMP threads used ranging in <img class="formulaInl" alt="$[2,12]$" src="../../form_110.png"/>. For the pure MPI and hybrid runs also some not balanced runs have performed. In particular, the tests with 3, 6 and 12 MPI processes are not balanced (having 16 blocks, the processes have different loads in these cases).</p>
<p><em>OFF</em> shows a good scalability on the shared memory architecture available. The pure MPI version exhibits a quasi-linear speedup for the balanced configurations, whereas OpenMP performance is lower. After a deep profiling some OpenMP issues have arisen: the current OpenMP (3.1) support for advanced Fortran 2003 features still lags behind and the most complex code sections had to be manually refactored to be parallelized. This clearly limits the performances which can be obtained especially when comparing to the pure MPI version. It is worth noting that, due to the memory bandwidth saturation the intra-node scaling is strongly limited up to 6 cores. As a consequence all the benchmarks using more than 6 cores show a non exciting speedup. As expected after the code profiling, the hybrid version scales better than the pure OpenMP.</p>
<table  border="0">
<tr>
<th><a class="anchor" id="fig-shaspeedup050"></a><div class="image">
<img src="../../shaspeedup050x050.png" alt="shaspeedup050x050.png"/>
<div class="caption">
Figure 1: <em>OFF</em> Scalability for the fifth test of Kurganov and Tadmor for grid level 1</div></div>
</th><th></th><th><a class="anchor" id="fig-shaspeedup100"></a><div class="image">
<img src="../../shaspeedup100x100.png" alt="shaspeedup100x100.png"/>
<div class="caption">
Figure 2: <em>OFF</em> Scalability for the fifth test of Kurganov and Tadmor for grid level 2</div></div>
 </th></tr>
<tr>
<th><a class="anchor" id="fig-shaspeedup200"></a><div class="image">
<img src="../../shaspeedup200x200.png" alt="shaspeedup200x200.png"/>
<div class="caption">
Figure 3: <em>OFF</em> Scalability for the fifth test of Kurganov and Tadmor for grid level 3</div></div>
</th><th></th><th><a class="anchor" id="fig-shaspeedup400"></a><div class="image">
<img src="../../shaspeedup400x400.png" alt="shaspeedup400x400.png"/>
<div class="caption">
Figure 4: <em>OFF</em> Scalability for the fifth test of Kurganov and Tadmor for grid level 4</div></div>
 </th></tr>
</table>
<h1><a class="anchor" id="DistributedMemSpeedUP"></a>
SpeedUp on Distributed Memory Architecture</h1>
<p>The available distributed memory cluster has a total of 20 nodes, but only 8 nodes (for a total of 64 cores) have been available for these benchmarks. The numerical grid used has 16 blocks thus a maximum of 16 MPI processes can be executed in parallel. Due to the nodes RAM limitation (8GB) the serial run with the finest grid (grid-4) uses swap memory, thus invalidate the reference performance. As a consequence, for the cluster benchmarks the finest grid used is the third. Figures <a class="el" href="../../de/d01/Scalability.html#fig-disspeedup050">5</a> and <a class="el" href="../../de/d01/Scalability.html#fig-disspeedup200">6</a> summarizes the tests matrix performed on the cluster architecture and the computed speedup only for the grid levels 1 and 3. <em>OFF</em> shows good scalability also on the distributed memory architecture. The inter-nodes performance are satisfactory as well as the intra-node scalability previously assessed on the shared memory workstation. The pure MPI and hybrid OpenMP/MPI codes are more efficient than the pure OpenMP version for the same overheads aforementioned. As expected, comparing the tests with different number of nodes and the number of cores used being equals, the best performance are obtained with the largest number of nodes because of the saturation of node memory bandwidth is minimized, e.g. comparing the MPI tests for grid-3 using 16 processors (with 2, 4 or 8 nodes) the best speedup is achieved with 8 nodes ( <img class="formulaInl" alt="$9.7\%$" src="../../form_111.png"/>) while the 2 nodes test is the worst ( <img class="formulaInl" alt="$16.9\%$" src="../../form_112.png"/>).</p>
<table  border="0">
<tr>
<th><a class="anchor" id="fig-disspeedup050"></a><div class="image">
<img src="../../disspeedup050x050.png" alt="disspeedup050x050.png"/>
<div class="caption">
Figure 5: <em>OFF</em> Scalability for the fifth test of Kurganov and Tadmor for grid level 1</div></div>
</th><th></th><th><a class="anchor" id="fig-disspeedup200"></a><div class="image">
<img src="../../disspeedup200x200.png" alt="disspeedup200x200.png"/>
<div class="caption">
Figure 6: <em>OFF</em> Scalability for the fifth test of Kurganov and Tadmor for grid level 3</div></div>
 </th></tr>
</table>
<p>It is worth noting that, the reported benchmarks analysis constitutes only a partial assessment of the <em>OFF</em> parallel scalability. In particular, tests on more powerful architectures (GIGA/PETA scale) with thousands to hundreds of thousands cores are necessary. On both the two architectures used the intra-node memory bandwidth limit has strongly affected the parallel scalability, more than the communications overheads. Indeed, this is a typical behavior of CFD codes, where the computations are orders of magnitude heavier than the communications. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Oct 8 2013 10:16:52 for OFF by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
