module Data_Type_Probe
!-----------------------------------------------------------------------------------------------------------------------------------
!!This module contains the definition of Type_Probe and its functions and subroutines.
!-----------------------------------------------------------------------------------------------------------------------------------

!-----------------------------------------------------------------------------------------------------------------------------------
USE IR_Precision ! Integers and reals precision definition.
!-----------------------------------------------------------------------------------------------------------------------------------

!-----------------------------------------------------------------------------------------------------------------------------------
implicit none
private
public:: Type_Probe
public:: init,set
public:: write,read
!-----------------------------------------------------------------------------------------------------------------------------------

!-----------------------------------------------------------------------------------------------------------------------------------
! Type_Probe definition:
type:: Type_Probe
  sequence
  integer(I_P):: b = 1_I_P                       ! Block (global map) index.
  integer(I_P):: i = 0_I_P, j = 0_I_P, k = 0_I_P ! Space indexes.
endtype Type_Probe
!-----------------------------------------------------------------------------------------------------------------------------------

!-----------------------------------------------------------------------------------------------------------------------------------
!!Write overloading.
interface write
  module procedure Write_Bin, Write_Ascii
endinterface
!!Read overloading.
interface read
  module procedure Read_Bin, Read_Ascii
endinterface
!-----------------------------------------------------------------------------------------------------------------------------------
contains
  elemental function init(b,i,j,k) result(probe)
  !---------------------------------------------------------------------------------------------------------------------------------
  !!Function for initializing Type_Probe.
  !---------------------------------------------------------------------------------------------------------------------------------

  !---------------------------------------------------------------------------------------------------------------------------------
  implicit none
  integer(I_P), intent(IN), optional:: b,i,j,k
  type(Type_Probe)::                   probe
  !---------------------------------------------------------------------------------------------------------------------------------

  !---------------------------------------------------------------------------------------------------------------------------------
  if (present(b)) probe%b = b
  if (present(i)) probe%i = i
  if (present(j)) probe%j = j
  if (present(k)) probe%k = k
  return
  !---------------------------------------------------------------------------------------------------------------------------------
  endfunction init

  elemental subroutine set(b,i,j,k,probe)
  !---------------------------------------------------------------------------------------------------------------------------------
  !!Subroutine for assignment Type_Probe.
  !---------------------------------------------------------------------------------------------------------------------------------

  !---------------------------------------------------------------------------------------------------------------------------------
  implicit none
  integer(I_P),     intent(IN), optional:: b,i,j,k
  type(Type_Probe), intent(INOUT)::        probe
  !---------------------------------------------------------------------------------------------------------------------------------

  !---------------------------------------------------------------------------------------------------------------------------------
  if (present(b)) probe%b = b
  if (present(i)) probe%i = i
  if (present(j)) probe%j = j
  if (present(k)) probe%k = k
  return
  !---------------------------------------------------------------------------------------------------------------------------------
  endsubroutine set

  ! write
  function Write_Bin(unit,probe) result(err)
  !---------------------------------------------------------------------------------------------------------------------------------
  !!Function for writing (binary, scalar) Type_Probe.
  !---------------------------------------------------------------------------------------------------------------------------------

  !---------------------------------------------------------------------------------------------------------------------------------
  implicit none
  integer(I_P),     intent(IN):: unit  ! logic unit
  type(Type_Probe), intent(IN):: probe
  integer(I_P)::                 err   ! Error traping flag: 0 no errors, >0 error occours.
  !---------------------------------------------------------------------------------------------------------------------------------

  !---------------------------------------------------------------------------------------------------------------------------------
  write(unit,iostat=err)probe
  return
  !---------------------------------------------------------------------------------------------------------------------------------
  endfunction Write_Bin

  function Write_Ascii(unit,format,probe) result(err)
  !---------------------------------------------------------------------------------------------------------------------------------
  !!Function for writing (ascii, scalar) Type_Probe.
  !---------------------------------------------------------------------------------------------------------------------------------

  !---------------------------------------------------------------------------------------------------------------------------------
  implicit none
  integer(I_P),     intent(IN):: unit   ! logic unit
  character(*),     intent(IN):: format ! format specifier
  type(Type_probe), intent(IN):: probe
  integer(I_P)::                 err    ! Error traping flag: 0 no errors, >0 error occours.
  !---------------------------------------------------------------------------------------------------------------------------------

  !---------------------------------------------------------------------------------------------------------------------------------
  select case(adjustl(trim(format)))
  case('*')
    write(unit,*,iostat=err)probe
  case default
    write(unit,adjustl(trim(format)),iostat=err)probe
  endselect
  return
  !---------------------------------------------------------------------------------------------------------------------------------
  endfunction Write_Ascii

  ! read
  function Read_Bin(unit,probe) result(err)
  !---------------------------------------------------------------------------------------------------------------------------------
  !!Function for reading (binary, scalar) Type_Probe.
  !---------------------------------------------------------------------------------------------------------------------------------

  !---------------------------------------------------------------------------------------------------------------------------------
  implicit none
  integer(I_P),     intent(IN)::    unit  ! logic unit
  type(Type_Probe), intent(INOUT):: probe
  integer(I_P)::                    err   ! Error traping flag: 0 no errors, >0 error occours.
  !---------------------------------------------------------------------------------------------------------------------------------

  !---------------------------------------------------------------------------------------------------------------------------------
  read(unit,iostat=err)probe
  return
  !---------------------------------------------------------------------------------------------------------------------------------
  endfunction Read_Bin

  function Read_Ascii(unit,format,probe) result(err)
  !---------------------------------------------------------------------------------------------------------------------------------
  !!Function for reading (ascii, scalar) Type_Probe.
  !---------------------------------------------------------------------------------------------------------------------------------

  !---------------------------------------------------------------------------------------------------------------------------------
  implicit none
  integer(I_P),     intent(IN)::    unit   ! logic unit
  character(*),     intent(IN)::    format ! format specifier
  type(Type_Probe), intent(INOUT):: probe
  integer(I_P)::                    err    ! Error traping flag: 0 no errors, >0 error occours.
  !---------------------------------------------------------------------------------------------------------------------------------

  !---------------------------------------------------------------------------------------------------------------------------------
  select case(adjustl(trim(format)))
  case('*')
    read(unit,*,iostat=err)probe
  case default
    read(unit,adjustl(trim(format)),iostat=err)probe
  endselect
  return
  !---------------------------------------------------------------------------------------------------------------------------------
  endfunction Read_Ascii
endmodule Data_Type_Probe
